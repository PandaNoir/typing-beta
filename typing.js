$(function(){$.getJSON("./tango.json",null,function(f){function k(a){return 0|Math.random()*a}var m=function(a){t.html(a[0]);l.html(a[1]);a=a[1];for(var b=0,d=a.length,c="";b<d;){var e=a.charAt(b+1)||"",c=0!==b?c+"<div>":c+"<div class='now'>",c=c+getRoman(a,b)[0].replace(/ /g,"&nbsp;"),c=c+"</div>";isSmallChar(e)||"\u3063"===a.charAt(b)?(b+=2,isSmallChar(a.charAt(b))&&(b+=1)):b+=1}h.is(".closed")?h.html(c+'<div id="close">\u25bc</div>').addClass("closed"):h.html(c+'<div id="close">\u25b2</div>').removeClass("closed")},
u=function(g,b,d){b=getRoman(g,b)[a.route[0]||0];g=b.slice(0,d).replace(/ /g,"&nbsp;");d=b.slice(d).replace(/ /g,"&nbsp;");h.find("div.now").html('<span class="red">'+g+"</span>"+d)};f.bsearch=function(a){for(var b=0,d=this.length,c;b<=d;)if(c=0|(b+d)/2,this[c][0]>a&&(d=c-1),this[c][0]<a&&(b=c+1),this[c][0]===a)return c;return-1};var p=!1,a={strPos:0,pos:0,now:k(f.length),route:[null]},q=0,n=0,v=!1,t=$("#kanji"),l=$("#hiragana"),x=$("#miss"),y=$("#collect"),h=$("#roman"),r=0;t.text("\u30b9\u30da\u30fc\u30b9\u30ad\u30fc\u3067\u30b9\u30bf\u30fc\u30c8");
var w=function(g){if(32===g.keyCode)return v=!0,$(window).off("keydown",w),m(f[a.now]),setInterval(function(){r=0|r+100;var a=n/(r/1E3),a=Math.round(100*a)/100;$("#typingSpeed").text(a+"\u56de/\u79d2")},100),h.on("click","#close",function(){h.is(".closed")?($("#close").text("\u25b2"),h.removeClass("closed")):($("#close").text("\u25bc"),h.addClass("closed"))}),$(window).on("keydown",function(b){var d=f[a.now][1],c=d.charAt(a.strPos+1);if(16!==b.which&&91!==b.which&&!b.ctrlKey&&!b.metaKey){var c=b.which,
e="";b.shiftKey?49===c?e="!":53===c?e="%":54===c?e="&":56===c?e="(":57===c?e=")":219===c?e="":221===c&&(e=""):32===c?e=" ":186===c?e=":":188===c?e=",":189===c?e="-":190===c?e=".":191===c&&(e="\u30fb");key=e;""===key&&b.shiftKey&&(key=String.fromCharCode(b.keyCode).toUpperCase());""!==key||b.shiftKey||(key=String.fromCharCode(b.keyCode).toLowerCase());b=moji(f[a.now][1],a.strPos,a.pos,key,a.route);if(!1===b.ok)q+=1,x.text("\u30df\u30b9:"+q);else return n+=1,y.text("\u6253\u9375\u6570:"+n),a.pos+=1,
a.route=b.route,"end"===b.ok&&(u(d,a.strPos,a.pos),c=d.charAt(a.strPos+1),h.find("div.now").removeClass("now").next().addClass("now"),b=d.charAt(a.strPos),isSmallChar(c)||"\u3063"===b?(a.strPos+=2,isSmallChar(d.charAt(a.strPos))&&(a.strPos+=1)):a.strPos+=1,a.strPos>=d.length&&(p||(a.now=k(f.length)),a.strPos=0,m(f[a.now])),a.route=[null],a.pos=0),u(f[a.now][1],a.strPos,a.pos),d=l.text().slice(0,a.strPos),b=l.text().slice(a.strPos),l.html('<span class="red">'+d+"</span>"+b),!1}}),!1};$(window).on("keydown",
function(g){if((g.ctrlKery&&!g.metaKey||!g.ctrlKey&&g.metaKey)&&89===g.keyCode&&g.shiftKey)return(p=!p)?($("body").addClass("TheYukari"),a.now=f.bsearch("\u7d50\u6708\u3086\u304b\u308a")):($("body").removeClass("TheYukari"),a.now=k(f.length)),v&&m(f[a.now]),a.route=[null],a.pos=0,!1}).on("keydown",w)}).error(function(f,k,m){console.log("\u30a8\u30e9\u30fc:"+k);console.log("\u30c6\u30ad\u30b9\u30c8:"+f.responseText)})});
