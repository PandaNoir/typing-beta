$(function(){$.getJSON("./tango.json",null,function(l){function t(e){return 0|Math.random()*e}var u=function(e,a){for(var d=0,b=e.length;d<b;d=0|d+1)if(e[d]===a)return!0;return!1},m={0:"0",1:"1",2:"2",3:"3",4:"4",5:"5",6:"6",7:"7",8:"8",9:"9","\u3042":"a","\u3044":"i","\u3046":"u","\u3048":"e","\u304a":"o","\u304b":"ka","\u304d":"ki","\u304f":"ku","\u3051":"ke","\u3053":"ko","\u3055":"sa","\u3057":"si,shi","\u3059":"su","\u305b":"se","\u305d":"so","\u305f":"ta","\u3061":"ti,chi","\u3064":"tu,tsu",
"\u3066":"te","\u3068":"to","\u306a":"na","\u306b":"ni","\u306c":"nu","\u306d":"ne","\u306e":"no","\u306f":"ha","\u3072":"hi","\u3075":"hu,fu","\u3078":"he","\u307b":"ho","\u307e":"ma","\u307f":"mi","\u3080":"mu","\u3081":"me","\u3082":"mo","\u3084":"ya","\u3086":"yu","\u3088":"yo","\u3089":"ra","\u308a":"ri","\u308b":"ru","\u308c":"re","\u308d":"ro","\u308f":"wa","\u3092":"wo","\u3093":"nn","\u304c":"ga","\u304e":"gi","\u3050":"gu","\u3052":"ge","\u3054":"go","\u3056":"za","\u3058":"zi,ji","\u305a":"zu",
"\u305c":"ze","\u305e":"zo","\u3060":"da","\u3062":"di","\u3065":"du","\u3067":"de","\u3069":"do","\u3070":"ba","\u3073":"bi","\u3076":"bu","\u3079":"be","\u307c":"bo","\u3071":"pa","\u3074":"pi","\u3077":"pu","\u307a":"pe","\u307d":"po","\u3058\u3083":"ja,zya,jixya,zixya","\u3058\u3085":"ju,zyu,jixyu,zixyu","\u3058\u3047":"je,zye,jixe,zixe","\u3058\u3087":"jo,zyo,jixyo,zixyo","\u3066\u3043":"thi,texi","\u3066\u3047":"the,text","\u3075\u3041":"fa,fuxa,huxa","\u3075\u3043":"fi,fuxi,huxi","\u3075\u3047":"fe,fuxe,huxe",
"\u3075\u3049":"fo,fuxo,huxo","\u3094\u3041":"va,vuxa","\u3094\u3043":"vi,vuxi","\u3094":"vu","\u3094\u3047":"ve,vuxe","\u3094\u3049":"vo,vuxo","\u3046\u3041":"uxa,wya","\u3046\u3043":"wi,uxi,whi","\u3046\u3047":"we,uxe,whe","\u3046\u3049":"uxo,who","\u3050\u3041":"gwa,guxa","\u3050\u3043":"gwi,guxi","\u3050\u3045":"gwu,guxu","\u3050\u3047":"gwe,guxe","\u3050\u3049":"gwo,guxo","\u3064\u3041":"tsa,tuxa,tsuxa","\u3064\u3043":"tsi,tuxi,tsuxi","\u3064\u3047":"tse,tuxe,tsuxe","\u3064\u3049":"tso,tuxo,tsuxo",
"\u3068\u3041":"twa,toxa","\u3068\u3043":"twi,toxi","\u3068\u3045":"twu,toxu","\u3068\u3047":"twe,toxe","\u3068\u3049":"two,toxo","\u3067\u3043":"dhi,dexi","\u3069\u3045":"dwu,doxu","\u30fc":"-","-":"-"," ":" ",",":",",":":":","(":"(",")":")","{":"{","}":"}",".":".","\u30fb":"\u30fb","!":"!",a:"a",A:"A",b:"b",B:"B",c:"c",C:"C",d:"d",D:"D",e:"e",E:"E",f:"f",F:"F",g:"g",G:"G",h:"h",H:"H",i:"i",I:"I",j:"j",J:"J",k:"k",K:"K",l:"l",L:"L",m:"m",M:"M",n:"n",N:"N",o:"o",O:"O",p:"p",P:"P",q:"q",Q:"Q",r:"r",
R:"R",s:"s",S:"S",t:"t",T:"T",u:"u",U:"U",v:"v",V:"V",w:"w",W:"W",x:"x",X:"X",y:"y",Y:"Y",z:"z",Z:"Z","&":"&","\u3002":".","%":"%"},h={"\u3042":"","\u3044":"","\u3046":"","\u3048":"","\u304a":"","\u304b":"k","\u304d":"k","\u304f":"k","\u3051":"k","\u3053":"k","\u3055":"s","\u3057":"s","\u3059":"s","\u305b":"s","\u305d":"s","\u305f":"t","\u3061":"t","\u3064":"t","\u3066":"t","\u3068":"t","\u306a":"n","\u306b":"n","\u306c":"n","\u306d":"n","\u306e":"n","\u306f":"h","\u3072":"h","\u3075":"h","\u3078":"h",
"\u307b":"h","\u307e":"m","\u307f":"m","\u3080":"m","\u3081":"m","\u3082":"m","\u3084":"y","\u3086":"y","\u3088":"y","\u3089":"r","\u308a":"r","\u308b":"r","\u308c":"r","\u308d":"r","\u308f":"w","\u304c":"g","\u304e":"g","\u3050":"g","\u3052":"g","\u3054":"g","\u3056":"z","\u3058":"z,j","\u305a":"z","\u305c":"z","\u305e":"z","\u3060":"d","\u3062":"d","\u3065":"d","\u3067":"d","\u3069":"d","\u3070":"b","\u3073":"b","\u3076":"b","\u3079":"b","\u307c":"b","\u3071":"p","\u3074":"p","\u3077":"p","\u307a":"p",
"\u307d":"p"},z=function(e){C.html(e[0]);x.html(e[1]);e=e[1];for(var a=0,d=e.length,b="";a<d;){var c=e.charAt(a+1)||"",b=0!==a?b+"<div>":b+"<div class='now'>",b=b+v(e,a)[0].replace(/ /g,"&nbsp;"),b=b+"</div>";p(c)||"\u3063"===e.charAt(a)?(a+=2,p(e.charAt(a))&&(a+=1)):a+=1}n.is(".closed")?n.html(b+'<div id="close">\u25bc</div>').addClass("closed"):n.html(b+'<div id="close">\u25b2</div>').removeClass("closed")},D=function(e,a,d){a=v(e,a)[c.route[0]||0];e=a.slice(0,d).replace(/ /g,"&nbsp;");d=a.slice(d).replace(/ /g,
"&nbsp;");n.find("div.now").html('<span class="red">'+e+"</span>"+d)},v=function(e,a){var d=e.charAt(a+1),b=[],c=e.charAt(a),f=function(a,b){var d;"\u3043"===b?d=["yi","ixi"]:"\u3047"===b?d=["ye","ixe"]:"\u3083"===b?d=["ya","ixya"]:"\u3085"===b?d=["yu","ixyu"]:"\u3087"===b&&(d=["yo","ixyo"]);var c=[];if(m[a+b])c=m[a+b].split(",");else if(-1!==h[a].indexOf(","))for(var e=h[a].split(","),f=e.length,g=0;g<f;g=0|g+1)c.push(e[g]+d[0]),c.push(e[g]+d[1]);else c=[h[a]+d[0],h[a]+d[1]];return c};if("\u3063"===
c)if(-1!==h[d].indexOf(",")||p(e.charAt(a+2)))if(b=[],p(e.charAt(a+2))){a+=1;d=e.charAt(a+1);b=f(c,d);--a;for(var d=e.charAt(a+1),k=h[d].split(","),g=g=k.length,f=0;f<g;f=0|f+1)for(var d=b.length,q=0;q<d;q=0|q+1)b.push("xtu"+b[q]),b.push("xtsu"+b[q]),b[q]=k[f]+b[q]}else for(k=q=h[d].split(","),g=k.length,f=0;f<g;f=0|f+1)b.push(k[f]+k[f]+m[d].slice(-1)),b.push("xtu"+m[d]),b.push("xtsu"+m[d]);else for(var k=m[d].split(","),f=0,g=k.length;f<g;f=0|f+1)b.push(h[d]+h[d]+m[d].slice(-1)),b.push("xtu"+k[f]),
b.push("xtsu"+k[f]);else b="\u3093"===c?""!==d&&(void 0===h[d]||"n"!==h[d]&&""!==h[d]&&"y"!==h[d])?["n"]:["nn"]:p(d)?"\u3043"===d||"\u3047"===d||"\u3083"===d||"\u3085"===d||"\u3087"===d?f(c,d):m[c+d].split(","):","!==m[c]?m[c].split(","):m[c];if("\u3093"===e.charAt(a-1)&&"n"!==h[c]&&""!==h[c])for(b=v(e.slice(a),0),f=0,g=b.length;f<g;f=0|f+1)b.push("n"+b[f]);return b},p=function(c){return"\u3041"===c||"\u3043"===c||"\u3045"===c||"\u3047"===c||"\u3049"===c||"\u3083"===c||"\u3085"===c||"\u3087"===c?
!0:!1};l.bsearch=function(c){for(var a=0,d=this.length,b;a<=d;)if(b=0|(a+d)/2,this[b][0]>c&&(d=b-1),this[b][0]<c&&(a=b+1),this[b][0]===c)return b;return-1};var A=!1,c={strPos:0,pos:0,now:t(l.length),route:[null]},B=0,y=0,E=!1,C=$("#kanji"),x=$("#hiragana"),G=$("#miss"),H=$("#collect"),n=$("#roman"),r=0;C.text("\u30b9\u30da\u30fc\u30b9\u30ad\u30fc\u3067\u30b9\u30bf\u30fc\u30c8");var F=function(e){if(32===e.keyCode)return E=!0,$(window).off("keydown",F),z(l[c.now]),setInterval(function(){r=0|r+100;
var a=y/(r/1E3),a=Math.round(100*a)/100;$("#typingSpeed").text(a+"\u56de/\u79d2")},100),n.on("click","#close",function(){n.is(".closed")?($("#close").text("\u25b2"),n.removeClass("closed")):($("#close").text("\u25bc"),n.addClass("closed"))}),$(window).on("keydown",function(a){var d=l[c.now][1],b=d.charAt(c.strPos+1);if(16!==a.which&&91!==a.which&&!a.ctrlKey&&!a.metaKey){var b=a.which,e="";a.shiftKey?49===b?e="!":53===b?e="%":54===b?e="&":56===b?e="(":57===b?e=")":219===b?e="":221===b&&(e=""):32===
b?e=" ":186===b?e=":":188===b?e=",":189===b?e="-":190===b?e=".":191===b&&(e="\u30fb");key=e;""===key&&a.shiftKey&&(key=String.fromCharCode(a.keyCode).toUpperCase());""!==key||a.shiftKey||(key=String.fromCharCode(a.keyCode).toLowerCase());a=l[c.now][1];var f=c.strPos,b=c.pos,e=key,k=c.route,k=k||[null],g=!1,h=[],w=a.charAt(f+1),r=a.charAt(f);if(p(w)||"\u3063"===r||"\u3093"===r||"\u3093"===a.charAt(f-1)){a=v(a,f);f=0;for(w=a.length;f<w;f+=1)a[f].charAt(b)===e&&(u(k,f)||u(k,null))&&(g=!0,b===a[f].length-
1&&(g="end"),h.push(f));a=g?{route:h,ok:g}:{ok:!1}}else if(0<m[r].indexOf(",")){a=m[a.charAt(f)].split(",");h=[];f=0;for(w=a.length;f<w;f+=1)a[f].charAt(b)===e&&(u(k,f)||u(k,null))&&(g=!0,b===a[f].length-1&&(g="end"),h.push(f));a=g?{route:h,ok:g}:{ok:!1}}else a=v(a,f)[k[0]||0],a.charAt(b)===e&&(g=!0,b===a.length-1&&(g="end")),a={route:[null],ok:g};if(!1===a.ok)B+=1,G.text("\u30df\u30b9:"+B);else return y+=1,H.text("\u6253\u9375\u6570:"+y),c.pos+=1,c.route=a.route,"end"===a.ok&&(D(d,c.strPos,c.pos),
b=d.charAt(c.strPos+1),n.find("div.now").removeClass("now").next().addClass("now"),a=d.charAt(c.strPos),p(b)||"\u3063"===a?(c.strPos+=2,p(d.charAt(c.strPos))&&(c.strPos+=1)):c.strPos+=1,c.strPos>=d.length&&(A||(c.now=t(l.length)),c.strPos=0,z(l[c.now])),c.route=[null],c.pos=0),D(l[c.now][1],c.strPos,c.pos),d=x.text().slice(0,c.strPos),a=x.text().slice(c.strPos),x.html('<span class="red">'+d+"</span>"+a),!1}}),!1};$(window).on("keydown",function(e){if((e.ctrlKery&&!e.metaKey||!e.ctrlKey&&e.metaKey)&&
89===e.keyCode&&e.shiftKey)return(A=!A)?($("body").addClass("TheYukari"),c.now=l.bsearch("\u7d50\u6708\u3086\u304b\u308a")):($("body").removeClass("TheYukari"),c.now=t(l.length)),E&&z(l[c.now]),c.route=[null],c.pos=0,!1}).on("keydown",F)}).error(function(l,t,u){console.log("\u30a8\u30e9\u30fc:"+t);console.log("\u30c6\u30ad\u30b9\u30c8:"+l.responseText)})});
