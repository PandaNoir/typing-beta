(function(r,g){g(function(){g.getJSON("./tango.json",null,function(j){Array.prototype.fPush=function(){for(var b=0,a=arguments.length;b<a;b+=1)this[this.length]=arguments[b];return this};Array.prototype.has=function(b){for(var a=0,f=this.length;a<f;a+=1)if(this[a]==b)return!0;return!1};Math.rand=function(b){return this.floor(this.random()*b)};var k={"0":"0",1:"1",2:"2",3:"3",4:"4",5:"5",6:"6",7:"7",8:"8",9:"9","\u3042":"a","\u3044":"i","\u3046":"u","\u3048":"e","\u304a":"o","\u304b":"ka","\u304d":"ki","\u304f":"ku","\u3051":"ke","\u3053":"ko","\u3055":"sa","\u3057":"si,shi","\u3059":"su","\u305b":"se","\u305d":"so","\u305f":"ta","\u3061":"ti,chi","\u3064":"tu,tsu","\u3066":"te","\u3068":"to","\u306a":"na","\u306b":"ni","\u306c":"nu","\u306d":"ne","\u306e":"no","\u306f":"ha","\u3072":"hi","\u3075":"hu,fu","\u3078":"he","\u307b":"ho","\u307e":"ma","\u307f":"mi","\u3080":"mu","\u3081":"me","\u3082":"mo","\u3084":"ya","\u3086":"yu","\u3088":"yo","\u3089":"ra","\u308a":"ri","\u308b":"ru","\u308c":"re","\u308d":"ro","\u308f":"wa","\u3092":"wo","\u3093":"nn","\u304c":"ga","\u304e":"gi","\u3050":"gu","\u3052":"ge","\u3054":"go","\u3056":"za","\u3058":"zi,ji","\u305a":"zu","\u305c":"ze","\u305e":"zo","\u3060":"da","\u3062":"di","\u3065":"du","\u3067":"de","\u3069":"do","\u3070":"ba","\u3073":"bi","\u3076":"bu","\u3079":"be","\u307c":"bo","\u3071":"pa","\u3074":"pi","\u3077":"pu","\u307a":"pe","\u307d":"po","\u3058\u3083":"ja,zya,jixya,zixya","\u3058\u3085":"ju,zyu,jixyu,zixyu","\u3058\u3047":"je,zye,jixe,zixe","\u3058\u3087":"jo,zyo,jixyo,zixyo","\u3066\u3043":"thi,texi","\u3066\u3047":"the,text","\u3075\u3041":"fa,fuxa,huxa","\u3075\u3043":"fi,fuxi,huxi","\u3075\u3047":"fe,fuxe,huxe","\u3075\u3049":"fo,fuxo,huxo","\u3094\u3041":"va,vuxa","\u3094\u3043":"vi,vuxi","\u3094":"vu","\u3094\u3047":"ve,vuxe","\u3094\u3049":"vo,vuxo","\u3046\u3041":"uxa,wya","\u3046\u3043":"wi,uxi,whi","\u3046\u3047":"we,uxe,whe","\u3046\u3049":"uxo,who","\u3067\u3043":"dhi,dexi","\u30fc":"-","-":"-"," ":" ",",":",",":":":","(":"(",")":")","{":"{","}":"}",".":".","\u30fb":"\u30fb","!":"!",a:"a",A:"A",b:"b",B:"B",c:"c",C:"C",d:"d",D:"D",e:"e",E:"E",f:"f",F:"F",g:"g",G:"G",h:"h",H:"H",i:"i",I:"I",j:"j",J:"J",k:"k",K:"K",l:"l",L:"L",m:"m",M:"M",n:"n",N:"N",o:"o",O:"O",p:"p",P:"P",q:"q",Q:"Q",r:"r",R:"R",s:"s",S:"S",t:"t",T:"T",u:"u",U:"U",v:"v",V:"V",w:"w",W:"W",x:"x",X:"X",y:"y",Y:"Y",z:"z",Z:"Z","&":"&","\u3002":".","%":"%"},h={"\u3042":"","\u3044":"","\u3046":"","\u3048":"","\u304a":"","\u304b":"k","\u304d":"k","\u304f":"k","\u3051":"k","\u3053":"k","\u3055":"s","\u3057":"s","\u3059":"s","\u305b":"s","\u305d":"s","\u305f":"t","\u3061":"t","\u3064":"t","\u3066":"t","\u3068":"t","\u306a":"n","\u306b":"n","\u306c":"n","\u306d":"n","\u306e":"n","\u306f":"h","\u3072":"h","\u3075":"h","\u3078":"h","\u307b":"h","\u307e":"m","\u307f":"m","\u3080":"m","\u3081":"m","\u3082":"m","\u3084":"y","\u3086":"y","\u3088":"y","\u3089":"r","\u308a":"r","\u308b":"r","\u308c":"r","\u308d":"r","\u308f":"w","\u304c":"g","\u304e":"g","\u3050":"g","\u3052":"g","\u3054":"g","\u3056":"z","\u3058":"z,j","\u305a":"z","\u305c":"z","\u305e":"z","\u3060":"d","\u3062":"d","\u3065":"d","\u3067":"d","\u3069":"d","\u3070":"b","\u3073":"b","\u3076":"b","\u3079":"b","\u307c":"b","\u3071":"p","\u3074":"p","\u3077":"p","\u307a":"p","\u307d":"p"},l=function(b){return r.document.getElementById(b)},v=function(b){z.html(b[0]);s.html(b[1]);b=b[1];for(var a=0,f=b.length,d="";a<f;){var e=b.charAt(a+1)||"",d=0!=a?d+("<div>"+p(b,a)[0].replace(/ /g,"&nbsp;")+"</div>"):d+('<div class="now">'+p(b,a)[0].replace(/ /g,"&nbsp;")+"</div>");n(e)||"\u3063"==b.charAt(a)?(a+=2,n(b.charAt(a))&&(a+=1)):a+=1}m.is(".closed")?m.html(d+'<div id="close">\u25bc</div>').addClass("closed"):m.html(d+'<div id="close">\u25b2</div>').removeClass("closed")},A=function(b,a,f){b=p(b,a)[c.route[0]||0];m.find("div.now").html('<span class="red">'+b.slice(0,f).replace(/ /g,"&nbsp;")+"</span>"+b.slice(f).replace(/ /g,"&nbsp;"))},p=function(b,a){var f=b.charAt(a+1),d=[];if(n(f)||"\u3063"==b.charAt(a)||"\u3093"==b.charAt(a)){var e=function(c,e){if(k[b.charAt(a)+f])d=k[b.charAt(a)+f].split(",");else if(-1!=h[b.charAt(a)].indexOf(","))for(var g=0,j=h[b.charAt(a)].split(",").length;g<j;g++)d.fPush(h[b.charAt(a)].split(",")[g]+c,h[b.charAt(a)].split(",")[g]+e);else d=[h[b.charAt(a)]+c,h[b.charAt(a)]+e]};if("\u3063"==b.charAt(a))if(-1==h[f].indexOf(",")&&!n(b.charAt(a+2)))d=[h[f]+h[f]+k[f].charAt(k[f].length-1),"xtu"+k[f],"xtsu"+k[f]];else if(d=[],n(b.charAt(a+2))){a+=1;var f=b.charAt(a+1),c=[];"\u3043"==f?c=["yi","ixi"]:"\u3047"==f?c=["ye","ixe"]:"\u3083"==f?c=["ya","ixya"]:"\u3085"==f?c=["yu","ixyu"]:"\u3087"==f&&(c=["yo","ixyo"]);e(c[0],c[1]);a-=1;for(var f=b.charAt(a+1),e=0,c=h[f].split(","),j=c.length;e<j;e+=1)for(var g=0,m=d.length;g<m;g+=1)d.fPush("xtu"+d[g],"xtsu"+d[g]),d[g]=c[e]+d[g]}else{e=0;c=h[f].split(",");for(j=c.length;e<j;e+=1)d.fPush(c[e]+c[e]+k[f].charAt(k[f].length-1),"xtu"+k[f],"xtsu"+k[f])}else"\u3093"==b.charAt(a)?d=""!=f&&("n"!=h[f]&&""!=h[f]&&"y"!=h[f]||void 0==h[f])?["n"]:["nn"]:(c=["",""],"\u3043"==f?c=["yi","ixi"]:"\u3047"==f?c=["ye","ixe"]:"\u3083"==f?c=["ya","ixya"]:"\u3085"==f?c=["yu","ixyu"]:"\u3087"==f?c=["yo","ixyo"]:d=k[b.charAt(a)+f].split(","),""!=c[0]&&e(c[0],c[1]))}else d=","!=k[b.charAt(a)]?k[b.charAt(a)].split(","):k[b.charAt(a)];if("\u3093"==b.charAt(a-1)&&"n"!=h[b.charAt(a)]&&""!=h[b.charAt(a)]){d=p(b.slice(a),0);e=0;for(c=d.length;e<c;e+=1)d.fPush("n"+d[e])}return d},n=function(b){return"\u3041"==b||"\u3043"==b||"\u3045"==b||"\u3047"==b||"\u3049"==b||"\u3083"==b||"\u3085"==b||"\u3087"==b?!0:!1},w=!1,t=Math,c={strPos:0,pos:0,now:t.rand(j.length),route:[null]},x=0,u=0,B=!1,z=g(l("kanji")),s=g(l("hiragana")),D=g(l("miss")),E=g(l("collect")),m=g(l("roman")),y=0;j.bsearch=function(b){for(var a=0,c=this.length,d,e=Math;a<=c;)if(d=e.floor((a+c)/2),this[d][0]>b&&(c=d-1),this[d][0]<b&&(a=d+1),this[d][0]==b)return d};z.text("\u30b9\u30da\u30fc\u30b9\u30ad\u30fc\u3067\u30b9\u30bf\u30fc\u30c8");var C=function(b){if(32==b.keyCode)return B=!0,g(r).off("keydown",C),v(j[c.now]),setInterval(function(){y+=100;g(l("typingSpeed")).text(t.round(100*(u/(y/1E3)))/100+"\u56de/\u79d2")},100),m.on("click","#close",function(){m.is(".closed")?(g(l("close")).text("\u25b2"),m.removeClass("closed")):(g(l("close")).text("\u25bc"),m.addClass("closed"))}),g(r).on("keydown",function(a){var b=j[c.now][1].charAt(c.strPos+1),d=String.fromCharCode(a.keyCode);if(!(16==a.which||91==a.which||a.ctrlKey||a.metaKey)){if(a.shiftKey)if(57<a.which&&219>a.which)d=d.toUpperCase();else switch(a.which){case 49:d="!";break;case 53:d="%";break;case 54:d="&";break;case 56:d="(";break;case 57:d=")";break;case 219:d="{";break;case 221:d="}";break;default:d=d.toUpperCase()}else if(32<a.which&&186>a.which)d=d.toLowerCase();else switch(a.which){case 32:d=" ";break;case 186:d=":";break;case 188:d=",";break;case 189:d="-";break;case 190:d=".";break;case 191:d="\u30fb";break;default:d=d.toLowerCase()}a=j[c.now][1];var e=c.strPos,b=c.pos,g=c.route,g=g||[null],h=!1,l=[],q=a.charAt(e+1);if(n(q)||"\u3063"==a.charAt(e)||"\u3093"==a.charAt(e)||"\u3093"==a.charAt(e-1)){a=p(a,e);e=0;for(q=a.length;e<q;e+=1)if(a[e].charAt(b)==d&&(g.has(e)||g.has(null)))h=!0,b==a[e].length-1&&(h="end"),l.fPush(e);a=h?{route:l,ok:h}:{ok:!1}}else if(","!=k[a.charAt(e)]&&-1!=k[a.charAt(e)].indexOf(",")){a=k[a.charAt(e)].split(",");l=[];e=0;for(q=a.length;e<q;e+=1)if(a[e].charAt(b)==d&&(g.has(e)||g.has(null)))h=!0,b==a[e].length-1&&(h="end"),l.fPush(e);a=h?{route:l,ok:h}:{ok:!1}}else a=p(a,e)[g[0]||0],a.charAt(b)==d&&(h=!0,b==a.length-1&&(h="end")),a={route:[null],ok:h};if(!1==a.ok)x+=1,D.text("\u30df\u30b9:"+x);else return u+=1,E.text("\u6253\u9375\u6570:"+u),c.pos+=1,c.route=a.route,"end"==a.ok&&(A(j[c.now][1],c.strPos,c.pos),b=j[c.now][1].charAt(c.strPos+1),m.find("div.now").removeClass("now").next().addClass("now"),n(b)||"\u3063"==j[c.now][1].charAt(c.strPos)?(c.strPos+=2,n(j[c.now][1].charAt(c.strPos))&&(c.strPos+=1)):c.strPos+=1,c.strPos>=j[c.now][1].length&&(w||(c.now=t.rand(j.length)),c.strPos=0,v(j[c.now])),c.route=[null],c.pos=0),A(j[c.now][1],c.strPos,c.pos),s.html('<span class="red">'+s.text().slice(0,c.strPos)+"</span>"+s.text().slice(c.strPos)),!1}}),!1};g(r).on("keydown",function(b){if((b.ctrlKery&&!b.metaKey||!b.ctrlKey&&b.metaKey)&&89==b.keyCode&&b.shiftKey)return(w=!w)?(g("body").addClass("TheYukari"),c.now=j.bsearch("\u7d50\u6708\u3086\u304b\u308a")):(g("body").removeClass("TheYukari"),c.now=t.rand(j.length)),B&&v(j[c.now]),c.route=[null],c.pos=0,!1}).on("keydown",C)})})})(this,jQuery);